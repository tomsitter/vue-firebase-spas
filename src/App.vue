<template>
  <div id="app">
    <Navigation :user="user" @logout="logout" />
    <router-view 
        class="container" 
        :user="user" 
        @logout="logout"
        @addMeeting="addMeeting"
    />
  </div>
</template>

<script>
import Navigation from "@/components/Navigation.vue";
import db from "./db.js";
import Firebase from "firebase";
export default {
    name: "App",
    data: function() {
      return {
          user: null
      };
    },
    methods: {
        logout: function() {
            Firebase.auth()
            .signOut()
            .then( () => {
                this.user = null;
                this.$router.push("login");
            });
        },
        addMeeting: function(payload) {
            db.collection("users")
            .doc(this.user.uid)
            .collection("meetings")
            .add({
                name: payload,
                createdAt: Firebase.firestore.FieldValue.serverTimestamp()
            });
        }
    },
    mounted() {
        Firebase.auth().onAuthStateChanged(user => {
            if (user) {
                this.user = user;
            }
        });
    },
    components: {
        Navigation
    }
}
</script>

<style lang="scss">
$primary: #05b2dd;
@import "node_modules/bootstrap/scss/bootstrap";
</style>
